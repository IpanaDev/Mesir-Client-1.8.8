package ipana.modules.exploit;

import ipana.events.EventPacketReceive;
import ipana.events.EventPreUpdate;
import ipana.managements.module.Category;
import ipana.managements.module.Module;
import ipana.managements.value.values.ModeValue;
import ipana.utils.player.PlayerUtils;
import net.minecraft.network.play.server.S02PacketChat;
import net.minecraft.util.ChatComponentText;
import net.minecraft.util.StringUtils;
import org.lwjgl.input.Keyboard;
import pisi.unitedmeows.eventapi.event.listener.Listener;

public class AutoCode extends Module {
    public AutoCode() {
        super("AutoCode", Keyboard.KEY_NONE, Category.Exploit, "Auto write the code.");
    }

    private Listener<EventPacketReceive> onReceive = new Listener<EventPacketReceive>(event -> {
        if (event.getState() != EventPacketReceive.PacketState.PRE) {
            return;
        }
        S02PacketChat chat = (S02PacketChat) event.getPacket();
        String message = StringUtils.stripControlCodes(chat.getChatComponent().getUnformattedText());
        //PlayerUtils.debug(message);
        if (chat.getChatComponent().getUnformattedText().startsWith("[ChatEvent] Ilk \"")) {
            //PlayerUtils.debug("Code: "+code(message));
            //mc.thePlayer.addChatMessage(new ChatComponentText(":DDD"+chat.getChatComponent().getFormattedText()));
            mc.thePlayer.sendChatMessage("!"+code(message));
        }
    }).filter(filter -> filter.getPacket() instanceof S02PacketChat);

    private String code(String message) {
        StringBuilder builder = new StringBuilder();
        boolean listen = false;
        for (int i = 0; i < message.length(); i++) {
            char c = message.charAt(i);
            if (listen) {
                if (c == '"') {
                    return builder.toString();
                }
                builder.append(c);
            } else if (c == '"') {
                listen = true;
            }
        }
        return builder.toString();
    }
}
