package ipana.modules.exploit;

import ipana.events.EventPacketReceive;
import ipana.managements.module.Category;
import ipana.managements.module.Module;
import net.minecraft.network.play.server.*;
import net.minecraft.util.ChatComponentText;
import net.minecraft.util.StringUtils;
import org.lwjgl.input.Keyboard;

import pisi.unitedmeows.eventapi.event.listener.Listener;

public class AutoMute extends Module {
    public AutoMute() {
        super("AutoMute", Keyboard.KEY_NONE, Category.Exploit, "Auto mute.");
    }


    private Listener<EventPacketReceive> onReceive = new Listener<EventPacketReceive>(event -> {
        S02PacketChat chat = (S02PacketChat) event.getPacket();
        String message = StringUtils.stripControlCodes(chat.getChatComponent().getUnformattedText());
        String[] splitDDD = message.split("]");
        String[] splitDDD2 = splitDDD[splitDDD.length-1].split(":");
        String sender = splitDDD2[0];
        //String chatMessage = splitDDD[splitDDD.length-1].split(":")[1];
        //String chatMessageSpace = splitDDD[splitDDD.length-1].split(":")[1].replace(" ","");
        if (splitDDD2.length <= 1) {
            return;
        }
        String[] spaceSplit = splitDDD2[1].split(" ");
        System.out.println("gn3");
        if (sender.equals(mc.thePlayer.getName())) {
            return;
        }
        String dies = "a꧄na꧄n2꧄";
        boolean muted = false;
        for (int i = 0; i < spaceSplit.length; i++) {
            String str = spaceSplit[i];
            String chattt = str.replace("4", "a").replace("0", "o").replace("@", "a").replace("1", "ı").replace("2", "iki").replace("3", "e").replace("$", "s").replace("\u061C","").replace("\u05FC","");
            for (String strings : new String[]{"allahını", "allahini"}) {
                if (similarity(strings, chattt) > 0.75) {
                    //if (spaceSplit[i+1].) {
                    mc.thePlayer.sendChatMessage("/sus " + sender + " 3d OtoMute Allaha hakaret");
                    muted = true;
                    //mc.thePlayer.addChatMessage(new ChatComponentText(".mute " + sender + " küfür 5m"));
                    //}
                }
                if (muted) {
                    break;
                }
            }
            if (!muted) {
                for (String strings : new String[]{"atatürkünü","ataturkune"}) {
                    if (similarity(strings, chattt) > 0.75) {
                        //if (spaceSplit[i+1].) {
                        mc.thePlayer.sendChatMessage("/sus " + sender + " 3d OtoMute Atatürke Hakaret");
                        muted = true;
                        //mc.thePlayer.addChatMessage(new ChatComponentText(".mute " + sender + " küfür 5m"));
                        //}
                    }
                    if (muted) {
                        break;
                    }
                }
            }
            if (!muted) {
                for (String strings : new String[]{"sehitlerini","şehitlerini"}) {
                    if (similarity(strings, chattt) > 0.75) {
                        //if (spaceSplit[i+1].) {
                        mc.thePlayer.sendChatMessage("/sus " + sender + " 3d OtoMute Şehitlere Hakaret");
                        muted = true;
                        //mc.thePlayer.addChatMessage(new ChatComponentText(".mute " + sender + " küfür 5m"));
                        //}
                    }
                    if (muted) {
                        break;
                    }
                }
            }
            if (!muted) {
                for (String strings : new String[]{"dinini","muhammedini","muhammetini","muhamedini"}) {
                    if (similarity(strings, chattt) > 0.75) {
                        mc.thePlayer.sendChatMessage("/sus " + sender + " 3d OtoMute Dine Hakaret");
                        muted = true;
                    }
                    if (muted) {
                        break;
                    }
                }
            }
            if (!muted) {
                for (String strings : new String[]{"orospu","ananı", "anneni", "babanı", "ablani", "ablanı", "evladı", "evladi", "oç", "piç", "pic", "ceddini", "sülaleni", "anneanneni", "nineni", "dedeni", "baldızını", "kayınvalideni", "kayınpederini", "görümceni", "öç"}) {
                    if (!chattt.equals("anan") && !chattt.equals("baban") && !chattt.equals("edeni")) {
                        if (similarity(strings, chattt) > 0.75) {
                            if (!strings.equals("orospu") || (i + 1 < spaceSplit.length && (similarity("cocugu", spaceSplit[i + 1].replace("ğ","g").replace("ç", "c").replace("4", "a").replace("0", "o").replace("@", "a").replace("1", "ı").replace("2", "iki").replace("3", "e").replace("$", "s").replace("\u061C", "").replace("\u05FC", "")) > 0.75 || spaceSplit[i + 1].replace("ğ","g").replace("ç", "c").replace("4", "a").replace("0", "o").replace("@", "a").replace("1", "ı").replace("2", "iki").replace("3", "e").replace("$", "s").replace("\u061C", "").replace("\u05FC", "").equals("cocu")))) {
                                mc.thePlayer.sendChatMessage("/sus " + sender + " 15m OtoMute Ailevi");
                                muted = true;
                            }
                        }
                    }
                    if (muted) {
                        break;
                    }
                }
            }
            if (!muted) {
                for (String strings : new String[]{"kürt"}) {
                    if (similarity(strings, chattt) > 0.75) {
                        //if (spaceSplit[i+1].) {
                        mc.thePlayer.sendChatMessage("/sus " + sender + " 15m OtoMute ırkçılık");
                        muted = true;
                        //mc.thePlayer.addChatMessage(new ChatComponentText(".mute " + sender + " küfür 5m"));
                        //}
                    }
                    if (muted) {
                        break;
                    }
                }
            }
            if (muted) {
                break;
            }
            //mc.thePlayer.addChatMessage(new ChatComponentText(sender));
        }
    }).filter(filter -> filter.getPacket() instanceof S02PacketChat);


    public double similarity(String s1, String s2) {
        String longer = s1, shorter = s2;
        if (s1.length() < s2.length()) { // longer should always have greater length
            longer = s2;
            shorter = s1;
        }
        int longerLength = longer.length();
        if (longerLength == 0) {
            return 1.0;
        }
        return (longerLength - editDistance(longer, shorter)) / (double) longerLength;

    }

    public int editDistance(String s1, String s2) {
        s1 = s1.toLowerCase();
        s2 = s2.toLowerCase();

        int[] costs = new int[s2.length() + 1];
        for (int i = 0; i <= s1.length(); i++) {
            int lastValue = i;
            for (int j = 0; j <= s2.length(); j++) {
                if (i == 0)
                    costs[j] = j;
                else {
                    if (j > 0) {
                        int newValue = costs[j - 1];
                        if (s1.charAt(i - 1) != s2.charAt(j - 1))
                            newValue = Math.min(Math.min(newValue, lastValue),
                                    costs[j]) + 1;
                        costs[j - 1] = lastValue;
                        lastValue = newValue;
                    }
                }
            }
            if (i > 0)
                costs[s2.length()] = lastValue;
        }
        return costs[s2.length()];
    }
}
